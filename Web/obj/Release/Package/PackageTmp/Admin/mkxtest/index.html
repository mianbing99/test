<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
</style>
<script src="../js/jquery-1.11.3.js"></script>
<title></title>
</head>
<body>
<canvas id="c"></canvas>
<script type="text/javascript">
	$(document).ready(function() {
		var canvas = document.getElementById("c");
		var ctx = canvas.getContext("2d");
		var c = $("#c");
		var x,y,w,h,cx,cy,l;
		var y = [];
		var b = {
			n:100,
			c:false,    //  颜色  如果是false 则是随机渐变颜色
			bc:'#000',   //  背景颜色
			r:0.9, 
			o:0.05,
			a:1,
			s:20,
		}
		var bx = 0,by = 0,vx = 0,vy = 0;
		var td = 0;
		var p = 0;
		var hs = 0;
		re();
		var color,color2;
		if(b.c){
			color2 = b.c;
		}else{
			color = Math.random()*360;
		}
		
		$(window).resize(function(){
			re();
		});
		var tp1 = false, tp2 = false, tp3 = true, tp9 = false, tp0 = false;
		function begin(){
			if(tp1){
				if(!b.c){
					color+=.1;
					color2 = 'hsl('+color+',100%,80%)';
				}
				ctx.globalAlpha = 1;
				ctx.fillStyle = b.bc;
				ctx.fillRect(0,0,w,h);
				for(var i=0;i<y.length;i++){
					ctx.globalAlpha = y[i].o;
					ctx.fillStyle = color2;
					ctx.beginPath();
					ctx.arc(y[i].x,y[i].y,y[i].r,0,Math.PI*2);
					ctx.closePath();
					ctx.fill();
					y[i].r+=b.r;
					y[i].o-=b.o;
					if(y[i].o<=0){
						y.splice(i,1);
						i--;
					};
				}
			}else if(tp2){
				if(!b.c){
					color+=.1;
					color2 = 'hsl('+color+',100%,80%)';
				}
				ctx.globalAlpha = 1;
				ctx.fillStyle = b.bc;
				ctx.fillRect(0,0,w,h);
				for(var i=0;i<y.length;i++){
					ctx.globalAlpha = y[i].o;
					ctx.fillStyle = color2;
					ctx.beginPath();
					y[i].r=10;
					ctx.shadowBlur=20;
					ctx.shadowColor=color2;
					ctx.arc(y[i].x,y[i].y,y[i].r,0,Math.PI*2);
					ctx.closePath();
					ctx.fill();
					ctx.shadowBlur=0;
					y[i].o-=b.o;
					y[i].v+=b.a;
					y[i].y+=y[i].v;
					if(y[i].y>=h+y[i].r || y[i].o<=0){
						y.splice(i,1);
						i--;
					};
				}
			}else if(tp3){
				if(!b.c){
					color+=.1;
					color2 = 'hsl('+color+',100%,80%)';
				}
				td+=5;
				ctx.globalAlpha = 1;
				ctx.fillStyle = b.bc;
				ctx.fillRect(0,0,w,h);
				for(var i=0;i<y.length;i++){
					ctx.globalAlpha = y[i].o;
					ctx.fillStyle = color2;
					ctx.beginPath();
					ctx.shadowBlur=20;
					ctx.shadowColor=color2;
					y[i].r=(1-(y[i].y/h))*20;
					ctx.arc(y[i].x,y[i].y,y[i].r,0,Math.PI*2);
					ctx.closePath();
					ctx.fill();
					ctx.shadowBlur=0;
					y[i].o=y[i].y/h;
					y[i].v+=b.a;
					y[i].y-=b.s;
					y[i].x+=(Math.cos((y[i].y+td)/100)*10);
					if(y[i].y<=0-y[i].r || y[i].o<=0){
						y.splice(i,1);
						i--;
					};
				}
			}else if(tp9){
				if(!b.c){
					color+=.1;
					color2 = 'hsl('+color+',100%,80%)';
				}
				ctx.globalAlpha = 0.2;
				ctx.fillStyle = b.bc;
				ctx.fillRect(0,0,w,h);
				ctx.fillStyle = color2;
				if(cx%4 == 0){
					cx+=1;
				}else if(cx%4 == 2){
					cx-=1
				}
				else if(cx%4 == 3){
					cx-=2
				}
				if(cy%4 == 0){
					cy+=1;
				}else if(cy%4 == 2){
					cy-=1
				}
				else if(cy%4 == 3){
					cy-=2
				}
				if(y.length<b.n){
					y.push({x:cx,y:cy,xv:0,yv:0,o:1});
				}
				for(var i=0;i<y.length;i++){
					if(y[i].xv==0 && y[i].yv==0){
						if(Math.random()<.5){
							if(Math.random()<.5){
								y[i].xv = 3;
							}else{
								y[i].xv = -3;
							}
						}else{
							if(Math.random()<.5){
								y[i].yv = 3;
							}else{
								y[i].yv = -3;
							}
						}
					}else{
						if(y[i].xv == 0){
							if(Math.random()<.66){
								y[i].yv = 0;
								if(Math.random()<.5){
									y[i].xv = 3;
								}else{
									y[i].xv = -3;
								}
							}
						}else if(y[i].yv == 0){
							if(Math.random()<.66){
								y[i].xv = 0;
								if(Math.random()<.5){
									y[i].yv = 3;
								}else{
									y[i].yv = -3;
								}
							}
						}
					}
					y[i].o-=b.o/2;
					ctx.globalAlpha = y[i].o;
					y[i].x+=y[i].xv;
					y[i].y+=y[i].yv;
					ctx.fillRect(y[i].x,y[i].y,3,3);
					if(y[i].o<=0){
						y.splice(i,1);
						i--;
					};
				}
			}else if(tp0){
				if(!b.c){
					color+=.1;
					color2 = 'hsl('+color+',100%,80%)';
				}
				ctx.globalAlpha = 0.2;
				ctx.fillStyle = b.bc;
				ctx.fillRect(0,0,w,h);
				ctx.fillStyle = color2;
				y.push({x:cx,y:cy,xv:2,yv:1,o:1});

				for(var i=0;i<y.length;i++){
					y[i].o-=b.o/10;
					ctx.globalAlpha = y[i].o;
					y[i].x+=(Math.random()-.5)*4;
					y[i].y-=1;
					ctx.fillRect(y[i].x,y[i].y,2,2);
					if(y[i].o<=0){
						y.splice(i,1);
						i--;
					};
				}
			}
			window.requestAnimationFrame(begin);
		}
		function re(){
			w = window.innerWidth;
			h = window.innerHeight;
			canvas.width = w;
			canvas.height = h;
			cx = w/2;
			cy = h/2;
		};
		c.mousemove(function(e){
			cx = e.pageX-c.offset().left;
			cy = e.pageY-c.offset().top;
			if(tp1 || tp2 || tp3){
				y.push({x:cx,y:cy,r:b.r,o:1,v:0});
			}
		});
		(function() {
			var lastTime = 0;
			var vendors = ['webkit', 'moz'];
			for(var xx = 0; xx < vendors.length && !window.requestAnimationFrame; ++xx) {
				window.requestAnimationFrame = window[vendors[xx] + 'RequestAnimationFrame'];
				window.cancelAnimationFrame = window[vendors[xx] + 'CancelAnimationFrame'] ||
											  window[vendors[xx] + 'CancelRequestAnimationFrame'];
			}
		
			if (!window.requestAnimationFrame) {
				window.requestAnimationFrame = function(callback, element) {
					var currTime = new Date().getTime();
					var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
					var id = window.setTimeout(function() {
						callback(currTime + timeToCall);
					}, timeToCall);
					lastTime = currTime + timeToCall;
					return id;
				};
			}
			if (!window.cancelAnimationFrame) {
				window.cancelAnimationFrame = function(id) {
					clearTimeout(id);
				};
			}
		}());
		begin();
	});
</script>

</body>
</html>

